# TDD Cycle: security-scan

## Overview

| Item | Value |
|------|-------|
| Feature | security-scan スキル実装 |
| Issue | #5 |
| Phase | DONE |
| Started | 2024-12-24 14:02 |

## Environment

| Tool | Version |
|------|---------|
| Claude Code | 2.0.75 |
| Platform | darwin (macOS) |

## Goal

セキュリティスキャンを実行するスキルを実装する。

### ワークフロー
1. RECON - recon-agentで情報収集
2. SCAN - 各攻撃エージェントを並行実行
3. REPORT - 結果をまとめて出力

### タスク
- skills/security-scan/SKILL.md 作成
- skills/security-scan/reference.md 作成

## PLAN

### スコープ

security-scanスキルの作成。エージェントを連携してセキュリティスキャンを実行。

### ファイル構成

```
plugins/redteam-core/skills/
└── security-scan/
    ├── SKILL.md       # スキル定義
    └── reference.md   # 詳細リファレンス
```

### スキル設計

```yaml
name: security-scan
description: セキュリティスキャンを実行。RECON→SCAN→REPORTワークフロー。
```

### ワークフロー

```
1. RECON Phase
   └── recon-agent で情報収集
       - エンドポイント列挙
       - フレームワーク検出
       - 攻撃優先度付け

2. SCAN Phase（並行実行）
   ├── injection-attacker（SQLi検出）
   └── xss-attacker（XSS検出）

3. REPORT Phase
   └── 結果を統合してJSON出力
```

### 出力形式

```json
{
  "metadata": {
    "scan_id": "<uuid>",
    "scanned_at": "<timestamp>",
    "target_directory": "<path>"
  },
  "recon": {
    "framework": "Laravel",
    "endpoints_count": 15,
    "high_priority_count": 5
  },
  "vulnerabilities": {
    "total": 3,
    "critical": 0,
    "high": 2,
    "medium": 1,
    "low": 0
  },
  "details": [
    {
      "agent": "injection-attacker",
      "id": "SQLI-001",
      "severity": "high",
      "file": "app/Controllers/UserController.php",
      "line": 45
    }
  ]
}
```

### 使用方法

```bash
/security-scan           # 現在のディレクトリをスキャン
/security-scan ./src     # 指定ディレクトリをスキャン
```

## Test List

### TODO
- [ ] TC-01: skills/security-scan/ ディレクトリが存在する
- [ ] TC-02: SKILL.md が存在する
- [ ] TC-03: YAML frontmatter（name, description）が存在する
- [ ] TC-04: ワークフロー（RECON/SCAN/REPORT）が定義されている
- [ ] TC-05: エージェント連携（recon-agent, injection-attacker, xss-attacker）が記載されている
- [ ] TC-06: 出力形式（JSONスキーマ）が存在する
- [ ] TC-07: reference.md が存在する
- [ ] TC-08: 使用方法が記載されている

## Phase Log

| Phase | Status | Note |
|-------|--------|------|
| INIT | Done | Cycle doc作成 |
| PLAN | Done | スキル設計、Test List作成 |
| RED | Done | 8テスト作成、全失敗確認 |
| GREEN | Done | SKILL.md, reference.md作成、全テスト成功 |
| REFACTOR | Done | リファクタリング不要（構造クリーン） |
| REVIEW | Done | テスト全PASS、code-review完了（Critical=v0.2.0対象） |
| COMMIT | Done | d40f263 |

## References

- [Claude Code Skills](https://docs.anthropic.com/claude-code/skills)
- [tdd-skills](https://github.com/morodomi/tdd-skills)
