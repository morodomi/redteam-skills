# Cycle: sca-scan

| Item | Value |
|------|-------|
| Issue | #41 |
| Phase | COMMIT |
| Created | 2026-01-14 15:55 |

## Environment

| Tool | Version |
|------|---------|
| Node.js | v22.17.0 |

## Goal

sca-attackerをsecurity-scanワークフローに統合し、依存関係脆弱性を自動検出できるようにする。

## Background

From Issue #41:
- sca-attackerをsecurity-scanのSCAN Phaseに追加
- 脆弱性サマリにSCA結果を含める
- attack-reportにSCA結果を出力

## Scope

From Issue #41:
- [ ] security-scan スキルにSCA統合
- [ ] --no-sca オプション追加
- [ ] attack-report にSCA結果出力

## PLAN

### Background

sca-attacker (#40) で依存関係脆弱性検出エージェントを実装済み。
このスキルで security-scan ワークフローに統合し、自動実行できるようにする。

### Design

#### 変更内容

1. **security-scan SKILL.md更新**
   - SCAN Phaseにsca-attackerを追加
   - `--no-sca` オプション追加
   - Agent Integrationテーブル更新
   - Output FormatにSCA結果追加

2. **attack-report対応**
   - 既存のJSON入力→Markdown出力の仕組みで対応可能
   - SCA結果がdetailsに含まれていれば自動的にレポート出力

#### Workflow変更

```
Before:
2. SCAN Phase（並行実行）
   ├── injection-attacker
   ├── xss-attacker
   ├── crypto-attacker
   └── error-attacker

After:
2. SCAN Phase（並行実行）
   ├── injection-attacker
   ├── xss-attacker
   ├── crypto-attacker
   ├── error-attacker
   └── sca-attacker        # 追加
```

#### Options追加

| Option | Description |
|--------|-------------|
| --no-sca | SCAスキャンをスキップ |

#### Output Format追加

```json
{
  "sca": {
    "packages_scanned": 45,
    "vulnerable_count": 3,
    "ecosystems": ["npm", "Packagist"]
  }
}
```

### Files

```
plugins/redteam-core/skills/security-scan/
└── SKILL.md              # 更新

scripts/
└── test-sca-scan.sh      # 新規
```

## Test List

### TODO

#### 正常系 - SKILL.md構造
- [ ] TC-01: security-scan SKILL.mdにsca-attackerが記載されている → WIP
- [ ] TC-02: SCAN Phaseにsca-attackerが追加されている
- [ ] TC-03: Agent Integrationテーブルにsca-attackerがある
- [ ] TC-04: --no-sca オプションがOptionsに記載されている
- [ ] TC-05: Output FormatにSCAセクションがある

#### 正常系 - 既存機能との互換性
- [ ] TC-06: 既存のattacker（injection/xss/crypto/error）が残っている
- [ ] TC-07: 既存のオプション（--dynamic等）が残っている

#### エッジケース
- [ ] TC-08: Usage例にSCA関連の説明がある

### WIP

(なし)

### DONE

- [x] TC-01: security-scan SKILL.mdにsca-attackerが記載されている
- [x] TC-02: SCAN Phaseにsca-attackerが追加されている
- [x] TC-03: Agent Integrationテーブルにsca-attackerがある
- [x] TC-04: --no-sca オプションがOptionsに記載されている
- [x] TC-05: Output FormatにSCAセクションがある
- [x] TC-06: 既存のattacker（injection/xss/crypto/error）が残っている
- [x] TC-07: 既存のオプション（--dynamic等）が残っている
- [x] TC-08: Usage例にSCA関連の説明がある

## REVIEW

### Quality Gate Results (Re-run)

| Reviewer | Score | Judgment |
|----------|-------|----------|
| correctness | 35 | PASS |
| performance | 35 | PASS |
| security | 25 | PASS |
| guidelines | 25 | PASS |

**Max Score: 35 → PASS**

### Resolved Issues

- reference.mdにsca-attackerを追加
- reference.mdのOutput Schemaにsca section追加
- Referencesにsca-attackerリンク追加

### Optional Improvements (deferred)

- reference.md Limitationsセクションにsca-attacker追加
- --no-sca時の挙動ドキュメント化

## Notes

- v4.0 マイルストーン
- 関連: #40 sca-attacker (完了), #46 sca-attacker改善
