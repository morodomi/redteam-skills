# Cycle: ssti-attacker

| Item | Value |
|------|-------|
| Issue | #31 |
| Phase | DONE |
| Created | 2026-01-08 15:03 |

## Environment

| Tool | Version |
|------|---------|
| Node.js | v22.17.0 |

## Goal

Server-Side Template Injection (SSTI) を検出するエージェントを新規作成する。

## Background

From Issue #31:
- 対象テンプレートエンジン: Blade, Jinja2, Twig, ERB, EJS
- OWASP: A03:2021 Injection
- CWE-1336: Improper Neutralization of Special Elements Used in a Template Engine

## Scope

From Issue #31:
- [ ] agents/ssti-attacker.md 作成
- [ ] Detection Patterns定義
- [ ] Output Format定義
- [ ] テストスクリプト作成

## PLAN

### Design

```
ssti-attacker.md
├── Detection Targets (Blade, Jinja2, Twig, ERB, EJS)
├── Framework Detection Patterns (危険/安全パターン)
├── Dangerous Patterns (正規表現)
├── Safe Patterns (誤検知除外)
├── Output Format (vulnerability_class: ssti)
└── Severity Criteria
```

### SSTI Type Definitions

| Type | Description | Engine |
|------|-------------|--------|
| blade-ssti | Laravel Bladeテンプレート注入 | Blade |
| jinja2-ssti | Flask/Django Jinja2注入 | Jinja2 |
| twig-ssti | Symfony Twig注入 | Twig |
| erb-ssti | Ruby ERB注入 | ERB |
| ejs-ssti | Express EJS注入 | EJS |

### Dangerous Patterns

| Engine | Pattern | Example |
|--------|---------|---------|
| Blade | `Blade::compileString($input)` | ユーザー入力をBladeコンパイル |
| Jinja2 | `render_template_string(input)` | 文字列テンプレート描画 |
| Jinja2 | `Template(input).render()` | 動的テンプレート生成 |
| Twig | `createTemplate($input)` | 動的テンプレート生成 |
| ERB | `ERB.new(input).result` | 動的ERB実行 |
| EJS | `ejs.render(input)` | 文字列テンプレート描画 |

### Safe Patterns (除外)

| Engine | Pattern | Reason |
|--------|---------|--------|
| Blade | `view('template', $data)` | ファイルベース |
| Jinja2 | `render_template('file.html')` | ファイルベース |
| Twig | `render('template.twig')` | ファイルベース |
| ERB | `erb :template` | シンボル指定 |
| EJS | `res.render('template')` | ファイルベース |

### CWE/OWASP Mapping

| Reference | ID |
|-----------|---|
| CWE | CWE-1336: Improper Neutralization of Special Elements Used in a Template Engine |
| OWASP | A03:2021 Injection |

### Files to Create/Modify

| File | Changes |
|------|---------|
| plugins/redteam-core/agents/ssti-attacker.md | 新規作成 |
| scripts/test-ssti-attacker.sh | テストスクリプト |

## Test List

### TODO

### WIP

### DONE
- [x] TC-01: [正常系] Blade SSTI検出
- [x] TC-02: [正常系] Jinja2 Flask SSTI検出
- [x] TC-03: [正常系] Jinja2 Django SSTI検出
- [x] TC-04: [正常系] Twig SSTI検出
- [x] TC-05: [正常系] ERB SSTI検出
- [x] TC-06: [正常系] EJS SSTI検出
- [x] TC-07: [境界値] 安全なパターン除外
- [x] TC-08: [エッジケース] 複数エンジン混在
- [x] TC-09: [異常系] 対象ファイルなし

## REVIEW

### quality-gate Results

| Agent | Score | Status |
|-------|-------|--------|
| Correctness | 25 | PASS |
| Performance | 25 | PASS |
| Security | 35 | PASS |
| Guidelines | 25 | PASS |

**Max Score: 35 (PASS)**

### Optional Improvements (Future)

- Handlebars/Mustache/Pug パターン追加
- Go html/template パターン追加
- Java Velocity/Thymeleaf パターン追加

## Notes

- v2.2 マイルストーン
- #35 e2e-ssti の前提条件
